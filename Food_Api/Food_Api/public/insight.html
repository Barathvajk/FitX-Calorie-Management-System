<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Agdasima:wght@700&family=Poppins:wght@500;600&display=swap" rel="stylesheet">
  <title>Food Insight</title>
  <style>
    /* Your CSS styles here */
   body {
        font-family: "Poppins", sans-serif;
        background-color: #f4f4f4;
        margin: 0;
        font-size: 15px;
        position: relative;
        }
    h1 {
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    th,
    td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
    .progress-bar {
      background-color: #f0f0f0;
      border-radius: 5px;
      height: 20px;
      margin-bottom: 10px;
    }
    .progress-bar-fill {
      background-color: #4caf50;
      border-radius: 5px;
      height: 100%;
    }
    #remainingContainer {
      width: 50%;
      margin: 0 auto;
      text-align: center;
    }

    .remaining-item {
      margin-bottom: 10px;
    }
    header {
    text-align: center;
    background-color:black;
    padding: 20px 0;
    margin-bottom: 20px;

    }

      header h1 {
        color: #fff;
        margin: 0;
      }
      nav {
        background-color:black;
        padding: 10px 0;
        text-align: center;
      }

      nav ul {
        list-style: none;
        margin: 0;
        padding: 0;
      }

      nav li {
        display: inline;
        margin-right: 20px;
      }

      nav a {
        color: #fff;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s ease;
      }

      nav a:hover {
      color: #0f0;
    }
  </style>
</head>
<body>
  <header>
    <h1>FIT<span style="color:#0f0">X</span></h1>
    </header>
  </header>
  <nav>
    <ul>
      <li><a class="active" href="http://localhost:5000/home">Home</a></li>
      <li><a href="http://localhost:5000/bmi">BMI Calculator</a></li>
      <li><a href="http://localhost:5000/bodyfat">Body Fat Calculator</a></li>
      <li><a href="http://localhost:5000/calorie">BMR Calculator</a></li>
      <li><a href="http://localhost:3000">Food Database</a></li>
      <li><a href="http://localhost:3000/insight.html">Insight</a></li>
      <li><a href="http://localhost:5000/about">About us</a></li>
      <li><a href="/">Log Out</a></li>
    </ul>
  </nav><br><br>
  <h1>Food Insight</h1>
    <div id="remainingContainer">
      <h2>Remaining Calories</h2>
      <div id="remainingCalories" class="remaining-item"></div>
      <div id="remainingBreakfast" class="remaining-item"></div>
      <div id="remainingLunch" class="remaining-item"></div>
      <div id="remainingSnack" class="remaining-item"></div>
      <div id="remainingDinner" class="remaining-item"></div>
    </div>
  
    <!-- Rest of your HTML content -->
  
  </body>
  
  <div>
    <label for="breakfastGoal">Breakfast Calorie Goal:</label>
    <input type="number" id="breakfastGoal" name="breakfastGoal" onchange="setCalorieGoals()">
  </div>
  <h2>Breakfast</h2>
  <div class="progress-bar">
    <div id="breakfastProgress" class="progress-bar-fill"></div>
  </div>
  <table id="breakfastTable">
    <thead>
      <tr>
        <th>Food Name</th>
        <th>Calories</th>
        <th>Protein</th>
        <th>Fat</th>
        <th>Carbs</th>
        <th>Serving Quantity</th>
        <th>Date and Time Added</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div>
    <label for="lunchGoal">Lunch Calorie Goal:</label>
    <input type="number" id="lunchGoal" name="lunchGoal" onchange="setCalorieGoals()">
  </div>
  <h2>Lunch</h2>
  <div class="progress-bar">
    <div id="lunchProgress" class="progress-bar-fill"></div>
  </div>
  <table id="lunchTable">
    <thead>
      <tr>
        <th>Food Name</th>
        <th>Calories</th>
        <th>Protein</th>
        <th>Fat</th>
        <th>Carbs</th>
        <th>Serving Quantity</th>
        <th>Date and Time Added</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div>
    <label for="snackGoal">Snack Calorie Goal:</label>
    <input type="number" id="snackGoal" name="snackGoal" onchange="setCalorieGoals()">
  </div>
  <h2>Snack</h2>
  <div class="progress-bar">
    <div id="snackProgress" class="progress-bar-fill"></div>
  </div>
  <table id="snackTable">
    <thead>
      <tr>
        <th>Food Name</th>
        <th>Calories</th>
        <th>Protein</th>
        <th>Fat</th>
        <th>Carbs</th>
        <th>Serving Quantity</th>
        <th>Date and Time Added</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div>
    <label for="dinnerGoal">Dinner Calorie Goal:</label>
    <input type="number" id="dinnerGoal" name="dinnerGoal" onchange="setCalorieGoals()">
  </div>
  <h2>Dinner</h2>
  <div class="progress-bar">
    <div id="dinnerProgress" class="progress-bar-fill"></div>
  </div>
  <table id="dinnerTable">
    <thead>
      <tr>
        <th>Food Name</th>
        <th>Calories</th>
        <th>Protein</th>
        <th>Fat</th>
        <th>Carbs</th>
        <th>Serving Quantity</th>
        <th>Date and Time Added</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let breakfastGoal = parseInt(localStorage.getItem('breakfastGoal')) || 0;
    let lunchGoal = parseInt(localStorage.getItem('lunchGoal')) || 0;
    let snackGoal = parseInt(localStorage.getItem('snackGoal')) || 0;
    let dinnerGoal = parseInt(localStorage.getItem('dinnerGoal')) || 0;
    let breakfastCalories = 0;
    let lunchCalories = 0;
    let snackCalories = 0;
    let dinnerCalories = 0;

    window.onload = function () {
      fetchFoodData();
      setInitialCalorieGoals();
    };

    function setInitialCalorieGoals() {
      document.getElementById("breakfastGoal").value = breakfastGoal;
      document.getElementById("lunchGoal").value = lunchGoal;
      document.getElementById("snackGoal").value = snackGoal;
      document.getElementById("dinnerGoal").value = dinnerGoal;
    }

    async function fetchFoodData() {
  try {
    const response = await fetch("/fetchFoodData");
    const data = await response.json();
    displayFoodData(data);
  } catch (error) {
    console.error("Error fetching food data:", error);
  }
}

    function formatDate(date) {
      const d = new Date(date);
      const day = d.getDate().toString().padStart(2, "0");
      const month = (d.getMonth() + 1).toString().padStart(2, "0");
      const year = d.getFullYear();
      return `${day}/${month}/${year}`;
    }

    function formatTime(date) {
      const d = new Date(date);
      const hours = d.getHours().toString().padStart(2, "0");
      const minutes = d.getMinutes().toString().padStart(2, "0");
      const seconds = d.getSeconds().toString().padStart(2, "0");
      return `${hours}:${minutes}:${seconds}`;
    }

    function setCalorieGoals() {
      breakfastGoal = parseInt(document.getElementById("breakfastGoal").value) || 0;
      lunchGoal = parseInt(document.getElementById("lunchGoal").value) || 0;
      snackGoal = parseInt(document.getElementById("snackGoal").value) || 0;
      dinnerGoal = parseInt(document.getElementById("dinnerGoal").value) || 0;
      localStorage.setItem('breakfastGoal', breakfastGoal);
      localStorage.setItem('lunchGoal', lunchGoal);
      localStorage.setItem('snackGoal', snackGoal);
      localStorage.setItem('dinnerGoal', dinnerGoal);
      updateProgressBars();
    }

    function updateProgressBars() {
  // Calculate progress for each meal
  const breakfastProgress = (breakfastCalories / breakfastGoal) * 100 || 0;
  const lunchProgress = (lunchCalories / lunchGoal) * 100 || 0;
  const snackProgress = (snackCalories / snackGoal) * 100 || 0;
  const dinnerProgress = (dinnerCalories / dinnerGoal) * 100 || 0;

  // Update progress bars
  document.getElementById("breakfastProgress").style.width = `${breakfastProgress}%`;
  document.getElementById("lunchProgress").style.width = `${lunchProgress}%`;
  document.getElementById("snackProgress").style.width = `${snackProgress}%`;
  document.getElementById("dinnerProgress").style.width = `${dinnerProgress}%`;

  // Check if goals are exceeded
  if (breakfastCalories > breakfastGoal) {
    document.getElementById("breakfastProgress").style.backgroundColor = "red";
    alert("Breakfast goal is exceeded!");
  } else {
    document.getElementById("breakfastProgress").style.backgroundColor = "#4caf50";
  }

  if (lunchCalories > lunchGoal) {
    document.getElementById("lunchProgress").style.backgroundColor = "red";
    alert("Lunch goal is exceeded!");
  } else {
    document.getElementById("lunchProgress").style.backgroundColor = "#4caf50";
  }

  if (snackCalories > snackGoal) {
    document.getElementById("snackProgress").style.backgroundColor = "red";
    alert("Snack goal is exceeded!");
  } else {
    document.getElementById("snackProgress").style.backgroundColor = "#4caf50";
  }

  if (dinnerCalories > dinnerGoal) {
    document.getElementById("dinnerProgress").style.backgroundColor = "red";
    alert("Dinner goal is exceeded!");
  } else {
    document.getElementById("dinnerProgress").style.backgroundColor = "#4caf50";
  }

  // Calculate remaining calories for each meal
  const remainingBreakfastCalories = breakfastGoal - breakfastCalories;
  const remainingLunchCalories = lunchGoal - lunchCalories;
  const remainingSnackCalories = snackGoal - snackCalories;
  const remainingDinnerCalories = dinnerGoal - dinnerCalories;

  // Display remaining calories for each meal
  document.getElementById("remainingBreakfast").innerText = `Remaining Breakfast Calories: ${remainingBreakfastCalories}`;
  document.getElementById("remainingLunch").innerText = `Remaining Lunch Calories: ${remainingLunchCalories}`;
  document.getElementById("remainingSnack").innerText = `Remaining Snack Calories: ${remainingSnackCalories}`;
  document.getElementById("remainingDinner").innerText = `Remaining Dinner Calories: ${remainingDinnerCalories}`;
}




function displayFoodData(foodData) {
  const breakfastTableBody = document.querySelector("#breakfastTable tbody");
  const lunchTableBody = document.querySelector("#lunchTable tbody");
  const snackTableBody = document.querySelector("#snackTable tbody");
  const dinnerTableBody = document.querySelector("#dinnerTable tbody");

  foodData.forEach((food) => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${food.food_name}</td>
      <td>${food.calories}</td>
      <td>${food.protein}</td>
      <td>${food.fat}</td>
      <td>${food.carbs}</td>
      <td>${food.serving_quantity}</td>
      <td>${formatDate(food.date_added)} ${formatTime(food.date_added)}</td> <!-- New column for date & time added -->
    `;

    switch (food.meal_name.toLowerCase()) {
      case "breakfast":
        breakfastTableBody.appendChild(row);
        breakfastCalories += food.calories;
        break;
      case "lunch":
        lunchTableBody.appendChild(row);
        lunchCalories += food.calories;
        break;
      case "snacks":
        snackTableBody.appendChild(row);
        snackCalories += food.calories;
        break;
      case "dinner":
        dinnerTableBody.appendChild(row);
        dinnerCalories += food.calories;
        break;
      default:
        console.error("Unknown meal name:", food.meal_name);
    }
  });

  updateProgressBars();
}

  </script>
</body>
</html>
